_context.invoke("Nittro.Extras.CheckList",function(DOM,Arrays){var CheckList=_context.extend("Nittro.Object",function(options){this._={options:Arrays.mergeTree({},CheckList.defaults,options),scrolling:!1},"string"==typeof this._.options.container&&(this._.options.container=DOM.getById(this._.options.container)),"string"==typeof this._.options.scroll?this._.options.scroll={container:this._.options.scroll}:this._.options.scroll===!0&&(this._.options.scroll={container:null}),this._.options.scroll&&(this._.options.scroll.speed||(this._.options.scroll.speed=3),this._.options.scroll.zoneSize||(this._.options.scroll.zoneSize=.1)),this._handleMouseDown=this._handleMouseDown.bind(this),this._handleClick=this._handleClick.bind(this),DOM.addListener(this._.options.container,"mousedown",this._handleMouseDown),DOM.addListener(this._.options.container,"click",this._handleClick)},{STATIC:{defaults:{container:null,items:null,boundary:"parent",horizontal:!1,scroll:!0}},destroy:function(){DOM.removeListener(this._.options.container,"mousedown",this._handleMouseDown),DOM.removeListener(this._.options.container,"click",this._handleClick)},_handleClick:function(evt){var target=this._getTarget(evt.target),items=this._getItems();items.indexOf(target)!==-1&&evt.preventDefault()},_handleMouseDown:function(mdevt){var target=this._getTarget(mdevt.target),items=this._getItems(),start=target?items.indexOf(target):-1;if(start!==-1){mdevt.preventDefault(),this.trigger("start",{target:target});var states,originalStates=items.map(this._getItemState.bind(this)),state=!originalStates[start],pos=this._.options.horizontal?mdevt.clientX:mdevt.clientY;this._setItemState(target,state),states=originalStates.slice(),states[start]=state;var handleMove=this._getMoveHandler(items,originalStates,states,start,state,pos),end=function(muevt){muevt&&muevt.preventDefault(),DOM.removeListener(document,"mousemove",handleMove),DOM.removeListener(document,"mouseup",end),this._.scrolling=!1,muevt&&this._getTarget(muevt.target)===target||states.some(function(s,i){return i!==start&&s!==originalStates[i]})?this.trigger("change"):this._setItemState(target,!state),this.trigger("end")}.bind(this);DOM.addListener(document,"mousemove",handleMove),DOM.addListener(document,"mouseup",end)}},_getMoveHandler:function(items,originalStates,states,start,state,prev){var pos,offs,coffs,scroll=this._getScrollInfo(),boundaryElems=this._getBoundaryElements(items),boundaries=this._getBoundaries(boundaryElems,start,scroll.window.offset),horiz=this._.options.horizontal,n=items.length;scroll.container&&scroll.container.offset>0&&(boundaries=boundaries.map(function(b){return b+scroll.container.offset}));var check=function(offs){coffs=scroll.container?scroll.container.offset:0;for(var i=0;i<n;i++)i!==start&&originalStates[i]!==state&&(i<start&&offs<boundaries[i]-coffs||i>start&&offs>boundaries[i]-coffs?states[i]!==state&&(this._setItemState(items[i],state),states[i]=state):states[i]!==!state&&(this._setItemState(items[i],!state),states[i]=!state))}.bind(this);return function(evt){evt.preventDefault(),pos=horiz?evt.clientX:evt.clientY,offs=scroll.window.offset+pos,check(offs),this._.scrolling?(this._.scrolling.direction===-1?pos>prev:pos<prev)?this._.scrolling=!1:this._.scrolling.lastMousePosition=pos:pos<prev&&(pos<scroll.window.prevThreshold||scroll.container&&offs<scroll.container.prevThreshold)?this._startScrolling(scroll,-1,pos,check):pos>prev&&(pos>scroll.window.nextThreshold||scroll.container&&offs>scroll.container.nextThreshold)&&this._startScrolling(scroll,1,pos,check),prev=pos}.bind(this)},_getTarget:function(target){return target},_setItemState:function(item,state){item.checked=state},_getItemState:function(item){return item.checked},_getItems:function(){return null===this._.options.items?Arrays.createFrom(this._.options.container.getElementsByTagName("input")).filter(function(elem){return"checkbox"===elem.type}):DOM.getByClassName(this._.options.items,this._.options.container)},_getBoundaryElements:function(items){if(this._.options.boundary){if("parent"===this._.options.boundary)return items.map(function(elem){return elem.parentNode});var sel=this._.options.boundary.split(/\./);return DOM.closest(items,sel[0],sel[1])}return items},_getBoundaries:function(elements,start,offset){return this._.options.horizontal?elements.map(function(elem,i){var rect=elem.getBoundingClientRect();return i<start?offset+rect.right:i>start?offset+rect.left:null}):elements.map(function(elem,i){var rect=elem.getBoundingClientRect();return i<start?offset+rect.bottom:i>start?offset+rect.top:null})},_startScrolling:function(info,dir,pos,check){function canScroll(target,dir){return dir<0?target.offset>0:target.offset<target.max}if(this._.scrolling={direction:dir,lastMousePosition:pos},canScroll(info.window,dir)||info.container&&canScroll(info.container,dir)){var doScroll=function(){if(info.container&&canScroll(info.container,dir))info.container.scrollBy(dir*this._.options.scroll.speed);else{if(!canScroll(info.window,dir))return;info.window.scrollBy(dir*this._.options.scroll.speed)}this._.scrolling&&(check(this._.scrolling.lastMousePosition+info.window.offset),window.requestAnimationFrame(doScroll))}.bind(this);window.requestAnimationFrame(doScroll)}},_getScrollInfo:function(){var size,zone,container=this._getScrollContainerInfo(),body=document.body||{},html=document.documentElement||{},win={};return this._.options.horizontal?(size=Math.max(body.scrollWidth,body.offsetWidth,html.clientWidth,html.scrollWidth,html.offsetWidth),zone=this._getScrollZoneSize(window.innerWidth),win.max=Math.max(0,size-window.innerWidth),win.offset=window.pageXOffset,win.offsetCross=window.pageYOffset,win.prevThreshold=zone,win.nextThreshold=window.innerWidth-zone,win.scrollBy=function(v){win.offset=Math.max(0,Math.min(win.max,win.offset+v)),window.scrollTo(win.offset,win.offsetCross)}):(size=Math.max(body.scrollHeight,body.offsetHeight,html.clientHeight,html.scrollHeight,html.offsetHeight),zone=this._getScrollZoneSize(window.innerHeight),win.max=Math.max(0,size-window.innerHeight),win.offset=window.pageYOffset,win.offsetCross=window.pageXOffset,win.prevThreshold=zone,win.nextThreshold=window.innerHeight-zone,win.scrollBy=function(v){win.offset=Math.max(0,Math.min(win.max,win.offset+v)),window.scrollTo(win.offsetCross,win.offset)}),container&&(zone=this._getScrollZoneSize(container.size),container.prevThreshold=win.offset+container.position+zone,container.nextThreshold=win.offset+container.position+container.size-zone,container.scrollBy=function(v){container.offset=Math.max(0,Math.min(container.max,container.offset+v)),container.element[container.prop]=container.offset}),{window:win,container:container}},_getScrollZoneSize:function(size){return this._.options.scroll.zoneSize<1?this._.options.scroll.zoneSize*size:this._.options.scroll.zoneSize},_getScrollContainerInfo:function(){function isScrollable(elem,overflow){return elem[props.scrollSize]>elem[props.clientSize]&&overflow in scrollable}function createInfo(elem){var rect=elem.getBoundingClientRect();return{element:elem,offset:elem[props.scrollProp],prop:props.scrollProp,max:elem[props.scrollSize]-elem[props.clientSize],size:elem[props.offsetSize],position:rect[props.position]}}var elem,sel,overflow,props=this._.options.horizontal?{scrollProp:"scrollLeft",scrollSize:"scrollWidth",clientSize:"clientWidth",offsetSize:"offsetWidth",overflow:"overflowX",position:"left"}:{scrollProp:"scrollTop",scrollSize:"scrollHeight",clientSize:"clientHeight",offsetSize:"offsetHeight",overflow:"overflowY",position:"top"},scrollable={scroll:1,auto:1};if("string"==typeof this._.options.scroll.container)return sel=this._.options.scroll.container.split(/\./),elem=DOM.closest(this._.options.container,sel[0],sel[1]),overflow=DOM.getStyle(elem,"overflow",!1),isScrollable(elem,overflow)?createInfo(elem):null;if(this._.options.scroll.container)return elem=this._.options.scroll.container,overflow=DOM.getStyle(elem,"overflow",!1),isScrollable(elem,overflow)?createInfo(elem):null;elem=this._.options.container;do{if(overflow=DOM.getStyle(elem,"overflow",!1),isScrollable(elem,overflow))return createInfo(elem);elem=elem.parentNode}while(elem&&elem!==document.body);return null}});_context.register(CheckList,"CheckList")},{DOM:"Utils.DOM",Arrays:"Utils.Arrays"});